{% extends 'base.html' %}

{% block content %}
<style>
@media (max-width: 767px) {
  .pagination .page-item:not(.page-item-back):not(.page-item-next) {
    display: none;
  }
}
</style>

<div class="container content-container">
    <h1 class="playlists-h1 mb-4">Your Playlists</h1>
    <div id="playlists-container" class="row">
        <!-- Playlists will be loaded here via JavaScript -->
    </div>
   <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center">
            <li class="page-item page-item-back {% if offset == 0 %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('playlists', offset=previous_offset) }}">Back</a>
            </li>
            {% for i in range((total_playlists - 1) // limit + 1) %}
                <li class="page-item {% if offset == i * limit %}active{% endif %}">
                    <a class="page-link" href="{{ url_for('playlists', offset=i * limit) }}">{{ i + 1 }}</a>
                </li>
            {% endfor %}
            <li class="page-item page-item-next {% if offset + limit >= total_playlists %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('playlists', offset=offset + limit) }}">Next</a>
            </li>
        </ul>
    </nav>
</div>

<script>
  async function fetchPlaylists() {
    const offset = {{ offset }};
    const limit = {{ limit }};
    const response = await fetch(`/api/playlists?offset=${offset}&limit=${limit}`);
    const data = await response.json();
    const playlists = data.playlists;
    const uniqueTrackCounts = data.unique_track_counts;
    const playlistImages = data.playlist_images;

    const playlistsContainer = document.getElementById('playlists-container');

    for (const playlist of playlists) {
      const uniqueTrackCount = uniqueTrackCounts[playlist.id];
      const playlistImage = playlistImages[playlist.id];

      const playlistCol = document.createElement('div');
      playlistCol.className = 'col-lg-4 col-md-6 col-sm-12 mb-4';

      const playlistCard = document.createElement('div');
      playlistCard.className = 'card playlist-card';

      const cardBody = document.createElement('div');
      cardBody.className = 'card-body';

      const cardTitle = document.createElement('h5');
      cardTitle.className = 'card-title';

      if (playlistImage) {
        const img = document.createElement('img');
        img.src = playlistImage;
        img.className = 'playlist-img mr-2';
        img.alt = playlist.name;
        cardTitle.appendChild(img);
      }

      const playlistName = document.createTextNode(playlist.name);
      cardTitle.appendChild(playlistName);
      cardBody.appendChild(cardTitle);

      const trackCountText = document.createElement('p');
      trackCountText.className = 'card-text';
      trackCountText.textContent = `Tracks: ${uniqueTrackCount}`;
      cardBody.appendChild(trackCountText);

      // Add the rest of the card elements, such as the "Rate Playlist" button, based on your original logic.

      playlistCard.appendChild(cardBody);
      playlistCol.appendChild(playlistCard);
      playlistsContainer.appendChild(playlistCol);
    }
  }

  fetchPlaylists();
</script>

{% endblock %}